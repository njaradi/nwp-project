<div class="container mt-4">

  <!-- Filter Row -->
  <div class="row g-2 mb-3 align-items-center">
    <div class="col-md-3">
      <input type="text" class="form-control" placeholder="Filter by name" [(ngModel)]="filterName">
    </div>

    <div class="col-md-2">
      <select class="form-select" [(ngModel)]="filterState">
        <option value="">All states</option>
        <option *ngFor="let s of states" [value]="s">{{ s }}</option>
      </select>
    </div>

    <div class="col-md-3">
      <input type="date" class="form-control" [(ngModel)]="filterDateFrom" placeholder="From date">
    </div>

    <div class="col-md-3">
      <input type="date" class="form-control" [(ngModel)]="filterDateTo" placeholder="To date">
    </div>
  </div>

  <!-- Add VM Row -->
  <div class="d-flex align-items-center gap-2 mb-4">
    <button class="btn btn-secondary" (click)="showAddForm = !showAddForm">
      {{ showAddForm ? 'Cancel' : 'New Machine' }}
    </button>

    <div class="add-form" [class.show]="showAddForm">
      <input type="text"
             class="form-control"
             placeholder="Machine name"
             [(ngModel)]="newVmName"
             (keyup.enter)="addVm()" />
      <button class="btn btn-primary" (click)="addVm()">Create</button>
    </div>
  </div>


  <!-- VM Grid -->
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
    <div *ngFor="let vm of filteredVmList" class="col">
      <div class="card h-100 border border-2 position-relative"
           [ngClass]="{
             'border-primary': vm.state === 'Running',
             'border-danger': vm.state === 'Crashed',
             'border-secondary': vm.state === 'Stopped',
             'border-warning': vm.state === 'Restarting',
             'border-info': vm.state === 'Turning off',
             'border-success': vm.state ==='Turning on'
           }">

        <div class="card-body">
          <h5 class="card-title">{{ vm.name }}</h5>
          <p class="card-text mb-1"><strong>State:</strong> {{ vm.state }}</p>
          <p class="card-text"><strong>Date:</strong> {{ vm.date }}</p>

          <div class="d-flex flex-wrap gap-2">
            <button *ngIf="isStopped(vm)" class="btn btn-outline-success btn-sm" (click)="turnon(vm)">Turn on</button>
            <button *ngIf="isRunning(vm)" class="btn btn-outline-secondary btn-sm" (click)="shutdown(vm)">Shut Down</button>
            <button *ngIf="isRunning(vm)" class="btn btn-outline-info btn-sm" (click)="restart(vm)">Restart</button>
          </div>
        </div>

        <button class="btn btn-outline-danger position-absolute top-0 end-0 m-2 btn-sm"
                (click)="deleteVm(vm.id)">Delete
          <i class="bi bi-trash"></i>
        </button>
      </div>
    </div>
  </div>
</div>
